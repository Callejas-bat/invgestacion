<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Prediction API</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script>
        async function loadJSON(url) {
            const response = await fetch(url);
            return await response.json();
        }

        function applyScaler(input, scaler) {
            return input.map((val, i) => (val - scaler.mean[i]) / scaler.scale[i]);
        }

        function inverseLabelEncode(pred, labelEncoder) {
            return labelEncoder.classes[pred];
        }

        async function initializePrediction() {
            try {
                const model = await tf.loadGraphModel('model.json');
                const scaler = await loadJSON('scaler.json');
                const labelEncoder = await loadJSON('label_encoder.json');

                const urlParams = new URLSearchParams(window.location.search);
                const hum = parseFloat(urlParams.get('hum'));
                const luz = parseFloat(urlParams.get('luz'));
                const pres = parseFloat(urlParams.get('pres'));
                const temp = parseFloat(urlParams.get('temp'));
                const vel = parseFloat(urlParams.get('vel'));

                if (isNaN(hum) || isNaN(luz) || isNaN(pres) || isNaN(temp) || isNaN(vel)) {
                    return { error: 'Invalid input parameters.' };
                }

                const input = [hum, luz, pres, temp, vel];
                const scaledInput = applyScaler(input, scaler);

                const tensorInput = tf.tensor2d([scaledInput], [1, 5]);
                const prediction = model.predict(tensorInput);
                const predClass = prediction.argMax(-1).dataSync()[0];
                const result = inverseLabelEncode(predClass, labelEncoder);

                return { prediction: result };

            } catch (error) {
                console.error('Error during prediction:', error);
                return { error: 'Error during prediction.' };
            }
        }

        async function renderResult() {
            const result = await initializePrediction();
            // Devuelve el JSON directamente como respuesta simulando el comportamiento de una API
            document.body.innerText = JSON.stringify(result); // Esto simula la respuesta JSON
        }

        // Ejecuta la funci√≥n cuando se carga el script
        renderResult();
    </script>
</head>
<body>
    <!-- El cuerpo se queda en blanco porque la respuesta es un JSON -->
</body>
</html>
